<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Mushroom</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <img src="cap-stem-logo.png" alt="Cap & Stem Logo" class="logo">
        <h1>Upload a Mushroom</h1>
    </div>

    <form id="uploadForm">
        <label for="imageUpload">Mushroom Image:</label>
        <input type="file" id="imageUpload" name="file" required>
        
        <label for="partType">Part Type:</label>
        <select id="partType" required>
            <option value="cap">Cap</option>
            <option value="stem">Stem</option>
        </select>

        <label for="uploadGenus">Genus:</label>
        <input type="text" id="uploadGenus" required>

        <label for="uploadSpecies">Species:</label>
        <input type="text" id="uploadSpecies" required>

        <button type="submit">Upload</button>
    </form>

    <script>
        const cloudName = 'mrlilholt';
        const uploadPreset = 'j6rx8tqb';

        document.getElementById('uploadForm').onsubmit = async function (e) {
            e.preventDefault();
            
            const file = document.getElementById('imageUpload').files[0];
            const genus = document.getElementById('uploadGenus').value;
            const species = document.getElementById('uploadSpecies').value;
            const partType = document.getElementById('partType').value;

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', uploadPreset);

            const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.secure_url) {
                alert("Upload successful!");

                // Store in Firestore (optional)
                const db = firebase.firestore();
                db.collection("mushrooms").add({
                    imageUrl: data.secure_url,
                    genus: genus,
                    species: species,
                    partType: partType,
                    uploadedAt: new Date()
                }).then(() => {
                    alert("Mushroom data saved.");
                    window.location.href = 'index.html';
                });
            } else {
                alert("Upload failed.");
            }
        };
    </script>
</body>
</html>
